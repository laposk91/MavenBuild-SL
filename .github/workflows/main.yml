name: CICD using Maven and Tomcat
on: # run when there is a commit to the repo
  push: # run when there is a commit to the repo
  workflow_dispatch: # run manually
jobs:
  CICDjobs:
    runs-on: ubuntu-latest
    steps:
      - name: Clone the repo on Ubuntu server
        uses: actions/checkout@v4

      - name: Install Java and Maven on Ubuntu server
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '11'
          cache: 'maven'

      - name: Build the code
        run: mvn package

      - name: Connect to my private machine and Deploy the code on Tomcat
        uses: cross-the-world/ssh-scp-ssh-pipelines@latest
        with:
          host: 172.25.60.203
          user: laposki
          pass: Adekunle91 
          port: 22
          connect_timeout: 10s
          first_ssh: |
            sudo chmod 777 /opt/tomcat/logs/
          scp: |
            './target/*.war' => /opt/tomcat/webapps/
          last_ssh: |
            sudo systemctl restart tomcat
